<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Royal Scribe: DPLC Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e;
            color: #e0e0e0;
        }
        .title-gradient {
            background: linear-gradient(90deg, #e94560, #f8b400);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .card {
            background-color: #16213e;
            border: 1px solid #0f3460;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        textarea {
            background-color: #0f3460;
            border: 1px solid #537895;
            color: #e0e0e0;
            transition: all 0.3s ease;
        }
        textarea:focus {
            outline: none;
            border-color: #e94560;
            box-shadow: 0 0 15px rgba(233, 69, 96, 0.5);
        }
        .btn {
            background: linear-gradient(90deg, #e94560, #f8b400);
            color: #16213e;
            font-weight: 700;
            border: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(233, 69, 96, 0.4);
        }
        .btn-secondary {
            background: #537895;
            color: #e0e0e0;
        }
        .btn-secondary:hover {
            background: #0f3460;
            box-shadow: 0 6px 15px rgba(15, 52, 96, 0.4);
        }
        #messageBox {
            transition: opacity 0.5s ease-in-out;
        }
    </style>
    <!-- The Magic Seeing Eye, as per The Decree of Development -->
    <script src="//cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init()</script>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-6xl mx-auto">
        <div class="card rounded-2xl p-6 md:p-10">
            <header class="text-center mb-8">
                <h1 class="text-4xl md:text-5xl font-bold title-gradient">The Royal Scribe</h1>
                <p class="text-lg text-gray-400 mt-2">A Pimp-Tight Artifact for Transmuting the DPLC from JSON to TXT</p>
            </header>

            <main class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">
                <!-- Input Section -->
                <div class="flex flex-col">
                    <label for="jsonInput" class="text-xl font-semibold mb-3">DPLC JSON Source</label>
                    <textarea id="jsonInput" class="flex-grow rounded-lg p-4 text-sm font-mono min-h-[300px] lg:min-h-[500px]" placeholder="Paste the sacred JSON of the DPLC here..."></textarea>
                </div>

                <!-- Output Section -->
                <div class="flex flex-col">
                    <label for="txtOutput" class="text-xl font-semibold mb-3">Transmuted TXT Output</label>
                    <textarea id="txtOutput" readonly class="flex-grow rounded-lg p-4 text-sm font-mono min-h-[300px] lg:min-h-[500px]" placeholder="The glorious plain text shall appear here..."></textarea>
                </div>
            </main>

            <!-- Action Buttons -->
            <footer class="mt-8 flex flex-col sm:flex-row items-center justify-center gap-4">
                <button id="convertBtn" class="btn w-full sm:w-auto px-8 py-3 rounded-lg text-lg">
                    Perform Transmutation
                </button>
                <button id="copyBtn" class="btn btn-secondary w-full sm:w-auto px-8 py-3 rounded-lg text-lg">
                    Copy to Clipboard
                </button>
            </footer>
        </div>
    </div>

    <!-- Custom Message Box for Notifications -->
    <div id="messageBox" class="fixed bottom-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 pointer-events-none">
        Copied to clipboard!
    </div>

    <script>
        // --- Core Logic for The Royal Scribe ---

        const jsonInput = document.getElementById('jsonInput');
        const txtOutput = document.getElementById('txtOutput');
        const convertBtn = document.getElementById('convertBtn');
        const copyBtn = document.getElementById('copyBtn');
        const messageBox = document.getElementById('messageBox');

        /**
         * The main function to initiate the conversion process.
         * It reads the JSON input, parses it, and calls the recursive
         * formatting function to generate the text output.
         */
        function performTransmutation() {
            const jsonString = jsonInput.value.trim();
            if (!jsonString) {
                txtOutput.value = "ERROR: The JSON source is empty. Please paste the DPLC.";
                return;
            }

            try {
                const dplcObject = JSON.parse(jsonString);
                // The recursive function that does the heavy lifting
                const formattedText = formatDPLC(dplcObject);
                txtOutput.value = formattedText;
            } catch (error) {
                console.error("Error during transmutation:", error);
                txtOutput.value = `ERROR: Failed to parse JSON.\n\nThis is likely a 'Poisoned Scroll' situation. Please ensure the JSON is complete and valid.\n\nDetails: ${error.message}`;
            }
        }
        
        /**
         * Recursively traverses the DPLC object and formats it into a
         * human-readable plain text string.
         * @param {object} obj - The current object or value to process.
         * @param {number} indentLevel - The current indentation level for formatting.
         * @returns {string} The formatted text representation.
         */
        function formatDPLC(obj, indentLevel = 0) {
            let output = '';
            const indent = '  '.repeat(indentLevel); // Two spaces per indent level

            // Handle different data types
            if (obj === null) {
                return `${indent}null\n`;
            }
            if (typeof obj !== 'object') {
                return `${indent}${obj}\n`;
            }

            // If it's an array, process each item
            if (Array.isArray(obj)) {
                obj.forEach(item => {
                    output += formatDPLC(item, indentLevel);
                });
                return output;
            }

            // If it's an object, process each key-value pair
            for (const key in obj) {
                if (Object.prototype.hasOwnProperty.call(obj, key)) {
                    const value = obj[key];
                    
                    // Custom formatting for specific DPLC keys to make it more readable
                    let formattedKey = formatKey(key);

                    if (typeof value === 'object' && value !== null) {
                        // Add a title-like header for major sections
                        if (indentLevel === 0) {
                            output += `\n${'='.repeat(80)}\n`;
                            output += `${formattedKey.toUpperCase()}\n`;
                            output += `${'='.repeat(80)}\n\n`;
                        } else if (key.toLowerCase().includes('title') || key.toLowerCase().includes('name')) {
                             output += `${indent}${'-'.repeat(4)} ${value} ${'-'.repeat(4)}\n`;
                             continue; // Skip default processing for this key as we've used its value as a title
                        } 
                        else {
                            output += `${indent}${formattedKey}:\n`;
                        }
                        output += formatDPLC(value, indentLevel + 1);
                    } else {
                        // Standard key-value pair
                        output += `${indent}${formattedKey}: ${String(value).replace(/\n/g, `\n${indent}  `)}\n\n`;
                    }
                }
            }
            return output;
        }

        /**
         * Formats a JSON key (e.g., 'partTitle') into a more readable
         * string (e.g., 'Part Title').
         * @param {string} key - The JSON key.
         * @returns {string} The formatted, human-readable key.
         */
        function formatKey(key) {
            // Add spaces before uppercase letters (camelCase to Title Case)
            const spaced = key.replace(/([A-Z])/g, ' $1');
            // Capitalize the first letter and return
            return spaced.charAt(0).toUpperCase() + spaced.slice(1);
        }

        /**
         * Copies the content of the output textarea to the user's clipboard.
         * Uses document.execCommand for broader compatibility within iframes.
         */
        function copyToClipboard() {
            if(!txtOutput.value) return;

            txtOutput.select();
            // Using document.execCommand as navigator.clipboard.writeText can be blocked in some iframe contexts
            try {
                document.execCommand('copy');
                // Show a success message
                messageBox.style.opacity = '1';
                setTimeout(() => {
                    messageBox.style.opacity = '0';
                }, 2000);
            } catch (err) {
                console.error('Failed to copy text: ', err);
                // In a real app, you'd show an error message to the user here.
            }
            // Deselect the text
            window.getSelection().removeAllRanges();
        }


        // --- Event Listeners ---
        convertBtn.addEventListener('click', performTransmutation);
        copyBtn.addEventListener('click', copyToClipboard);

    </script>
</body>
</html>
